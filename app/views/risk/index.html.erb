<% @page_heading = "Risks Page" + content_tag(:div, link_to("New Risk", {:controller => 'risk', :action => 'new'}, :class => 'btn info'), :class => 'pull-right') %>


  <h1> Risks for <%= @project.name %></h1>

<script type="text/javascript">
 function loadData(path, div_id) {
    var data_id = "#" +div_id
    var to_load = path + " #risk_info"
    jQuery(data_id).load(to_load);
  }
 function loadDat(path, div_id) {
  jQuery.get(path, function(data, xml) {
                var return_data = data;
                var data_id = "#"+ div_id;
                var return_data_html = return_data.substring(return_data.indexOf("<div id=\"risk_info\""));
                return_data_html = return_data_html.substring(0, return_data_html.indexOf("</div>")+6);
                alert(return_data_html);

                // document.getElementById(div_id).innerHTML = return_data_html;
});
  }
  function changeForm(proj_id, div_id) {
    div_button = "button_"+div_id.substring(div_id.indexOf("_")+1);

    if (document.getElementById(div_id).style.display == "none") {
        var path = "/project/"+ proj_id + "/risk/" + div_id.substring(div_id.indexOf("_")+1);
       loadData(path, div_id);
       document.getElementById(div_id).style.display = "block";
       document.getElementById(div_button).value = "-";
      }
    else {
        document.getElementById(div_id).style.display = "none";
        document.getElementById(div_button).value = "+";
      }
  }
</script>
<p><center><%= flash[:notice] %></center></p>
<p><center><%= params[:notice] %></center></p>
<p><center><%= params[:error] %></center></p>

<%= render_breadcrumbs %>

<%= button_to "+ Create New Risk", new_risk_path(params[:pid]), :class => 'btn btn info', :method => :get%>


<table class="zebra-striped clearfix" id="risks">
    <tr>
    <th><%= "Expand" %></th>
    <th><%= link_to "Risk ID", risk_index_path(params[:pid], :sort => "id") %></th>
    <th><%= link_to "Title", risk_index_path(params[:pid], :sort => "title") %></th>

    <th><%= link_to "Risk Owner", risk_index_path(params[:pid], :sort => "owner") %></th>
    <th><%= link_to "Risk Rating", risk_index_path(params[:pid], :sort => "risk_rating") %></th>
    <th><%= link_to "Early Impact", risk_index_path(params[:pid], :sort => "early_impact") %></th>
    <th><%= link_to "Last Impact", risk_index_path(params[:pid], :sort => "last_impact") %></th>
    <th><%= link_to "Status", risk_index_path(params[:pid], :sort => "status")%></th>
    <th><%= "Deactivate?" %></th>
    <th><%= "Reactivate?" %></th>
    </tr>
<%= render 'risk_list', {:risks => @risks } -%>
</table>

